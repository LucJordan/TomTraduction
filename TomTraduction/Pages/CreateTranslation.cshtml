@page "/translations/create"
@model TomTraduction.Pages.CreateTranslationModel
@{
    ViewData["Title"] = "Créer une Traduction";
}

<h2>Créer une Nouvelle Traduction</h2>

<div class="row">
    <div class="col-md-8">
        <form method="post">
            <div class="mb-3">
                <label for="Code" class="form-label">Code de la traduction *</label>
                <input type="text" class="form-control" asp-for="Translation.Code" placeholder="Code" required />
                <span asp-validation-for="Translation.Code" class="text-danger"></span>
            </div>
            <div class="mb-3">
                <label for="Fichier" class="form-label">Fichier de destination *</label>
                <select class="form-select" asp-for="Translation.Fichier" required>
                    <option value="">-- Sélectionner un fichier --</option>
                    @foreach (var file in Model.AvailableFiles)
                    {
                        <option value="@file">@file</option>
                    }
                </select>
                
            </div>
            <div class="mb-3">
                <label for="Francais" class="form-label">Français *</label>
                <textarea class="form-control" asp-for="Translation.Francais" rows="2" placeholder="Texte en français" required></textarea>
                <span asp-validation-for="Translation.Francais" class="text-danger"></span>
            </div>

            <div id="manualTranslations">
                <div class="mb-3">
                    <label for="Anglais" class="form-label">Anglais</label>
                    <textarea class="form-control" asp-for="Translation.Anglais" rows="2" placeholder="English text"></textarea>
                    <span asp-validation-for="Translation.Anglais" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label for="Portugais" class="form-label">Portugais</label>
                    <textarea class="form-control" asp-for="Translation.Portugais" rows="2" placeholder="Texto em português"></textarea>
                    <span asp-validation-for="Translation.Portugais" class="text-danger"></span>
                </div>
            </div>

            <div class="mb-3">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Créer la Traduction
                </button>
                <a href="/translations" class="btn btn-outline-secondary ms-2">
                    <i class="fas fa-arrow-left"></i> Retour
                </a>
            </div>
        </form>
    </div>
</div>
@{
    if (Model.Success.HasValue)
    {
        <div class="alert alert-@(Model.Success.Value ? "success" : "danger") mt-3">
        if (Model.Success.Value){
            <i class="fas fa-check-circle"></i> Traduction créée avec succès !
            <a href="/translations?Code=@Model.Translation.Code" class="btn btn-sm btn-outline-success ms-2">Voir la traduction</a>
        }
        else{
            <i class="fas fa-exclamation-triangle"></i> Erreur lors de la création de la traduction.
        }
        </div>
    }
}

<script>
    document.getElementById('Translation_AutoGenerate').addEventListener('change', function() {
        const manualDiv = document.getElementById('manualTranslations');
        manualDiv.style.display = this.checked ? 'none' : 'block';
    });

    document.getElementById('previewBtn').addEventListener('click', function() {
        const code = document.querySelector('[asp-for="Translation.Code"]').value;
        const francais = document.querySelector('[asp-for="Translation.Francais"]').value;
        const anglais = document.querySelector('[asp-for="Translation.Anglais"]').value;
        const portugais = document.querySelector('[asp-for="Translation.Portugais"]').value;
        const autoGen = document.getElementById('Translation_AutoGenerate').checked;

        const previewCard = document.getElementById('previewCard');
        const previewContent = document.getElementById('previewContent');

        if (code && francais) {
            previewContent.innerHTML = `
                <strong>Code :</strong> ${code}<br>
                <strong>Français :</strong> ${francais}<br>
                <strong>Anglais :</strong> ${autoGen ? '[EN] ' + francais : (anglais || 'Non spécifié')}<br>
                <strong>Portugais :</strong> ${autoGen ? '[PT] ' + francais : (portugais || 'Non spécifié')}
            `;
            previewCard.style.display = 'block';
        } else {
            previewCard.style.display = 'none';
        }
    });
</script>